### 从输入URL到页面加载发生了什么？

1. DNS 解析
2. TCP 连接
3. 发送 HTTP/HTTPS 请求
4. 服务器处理请求并返回 HTTP/HTTPS  报文
5. 浏览器解析渲染界面
6. 连接结束

#### DNS 解析过程

浏览器搜索自己的 DNS 缓存  → 搜索操作系统中的 DNS 缓存 → 搜索操作系统的 hosts 文件（windows 环境下）→ 操作系统将域名发送至 LDNS (本地域名服务器，本校或者运营商的DNS )，LDNS 查询自己的 DNS → LDNS 向Root Name Server （根域名服务器，存储用于每个域（com、net）的解析的顶级域名服务器的地址）请求，根域名服务器向 LDNS 返回具体域的 DNS 服务器地址→LDNS 向 com 域的域名服务器发起请求，得到具体的 IP 地址→LDNS 将得到的 IP 地址返回给操作系统，同时自己也将IP地址缓存。

#### 负载均衡

在请求真正进入到服务器前，可能还会先经过负载均衡服务器，它的作用是将请求合理地分配到多个服务器上，同时具备防御攻击等功能。比如在应用层实现的反向代理服务器 Nginx。

负载均衡服务器将请求定向到对应的web 服务器上，比如tomcat。

#### tomcat 处理过程

![](https://raw.githubusercontent.com/objcoding/objcoding.github.io/master/images/tomcat2.png)

Server：代表整个Tomcat，它包含所有的容器；

Service：相当于一个集合，包含多个Connector（连接）、一个Engine（引擎），它还负责处理所有Connector（连接）获取的客户请求；

Connector：一个Connector（连接）在指定的接口上侦听客户的请求，并将客户的请求交给Engine（引擎）来进行处理并获得回应返回给客户请求；

Engine：一个Engine（引擎）下可以配置多个虚拟主机Host，每个主机都有一个域名，当Engine获得一个请求时，会把这个请求发送的相应的Host上，Engine有一个默认的虚拟主机，如果没有虚拟主机能够匹配这个请求，那就由这个默认的虚拟主机来进行处理请求；

Host：代表一个Virtual host，每个虚拟主机都和某个网络域名想匹配，每个虚拟主机下面可以部署一个或者多个web app，每个web对应一个context，有一个context path，当一个host获取请求时，就把该请求匹配到某个context上；

Context：一个context对应一个web aplication，一个web由一个或多个servlet组成，Context在创建的时候将根据配置文件CATALINA_HOME/conf/web.xml和WEBAPP_HOME/WEB-INF/web.xml载入servlet类，当context获取请求时，将在自己的映射表中需找相匹配的servlet类，如果找到，则执行该类，获得请求的回应，并返回。

#### 处理请求过程

现在我来模拟Tomcat处理一个Http请求的过程：

设置一个来自客户端URL：http://localhost:8080/test/index

1. 服务器8080端口接收到客户发来的请求，被一个在那里监听的叫HTTP1.1的Connector获取了这个链接请求；
2. Connector把请求交给同在Service下的Engine去处理，并等待Engine的响应；
3. Engine把url解析，并把请求传给相对应的Host处理，如果没有相对应的Host，则用默认名叫localhost的Host来处理；
4. Host再把url解析为/webgateway/index.html，匹配context-path为/webgateway的Context去处理（如果匹配不到就把该请求交给路径名为””的Context去处理）；
5. context-path为/webgateway的Context会匹配Servlet Mapping为/index的Servlet处理；
6. 构造HttpServletRequest对象和HttpServletResponse对象，作为参数调用Servlet的doGet或doPost方法；
7. Context把处理完的HttpServletResponse对象返回给Host；
8. Host把HttpServletResponse对象返回给Engine；
9. Engine把HttpServletResponse对象返回给Connector；
10. Connector把HttpServletResponse对象返回给客户浏览器。

## HTTP 状态码

1. (信息类)：表示接收到请求并且继续处理
2. ​    **100——客户必须继续发出请求**
3. ​    **101——服务器已经理解了客户端的请求，并将通过Upgrade 消息头通知客户端采用不同的协议来完成这个请求。在发送完这个响应最后的空行后，服务器将会切换到在Upgrade 消息头中定义的那些协议。**



1.   2**(响应成功)：表示动作被成功接收、理解和接受
2. ​    200——表明该请求被成功地完成，所请求的资源发送回客户端
3. ​    201——提示知道新文件的URL
4. ​    202——接受和处理、但处理未完成
5. ​    203——返回信息不确定或不完整
6. ​    **204——请求收到，但返回信息为空**
7. ​    205——服务器完成了请求，用户代理必须复位当前已经浏览过的文件
8. ​    **206——服务器已经完成了部分用户的GET请求**
9. 
10.   3**(重定向类)：为了完成指定的动作，必须接受进一步处理
11. ​    **300——请求的资源可在多处得到**
12. ​    **301——本网页被永久性转移到另一个URL**
13. ​    **302——请求的网页被转移到一个新的地址，但客户访问仍继续通过原始URL地址，重定向，新的URL会在response中的Location中返回，浏览器将会使用新的URL发出新的Request。**
14. ​    **303——建议客户访问其他URL或访问方式**
15. ​    **304——自从上次请求后，请求的网页未修改过，服务器返回此响应时，不会返回网页内容，代表上次的文档已经被缓存了，还可以继续使用**
16. ​    305——请求的资源必须从服务器指定的地址得到
17. ​    306——前一版本HTTP中使用的代码，现行版本中不再使用
18. ​    307——申明请求的资源临时性删除（保护重定向中的资源 常用于POST）



1.   4**(客户端错误类)：请求包含错误语法或不能正确执行
2.   ​       **400——客户端请求有语法错误，不能被服务器所理解**
3.   ​       **401——请求未经授权，这个状态代码必须和WWW-Authenticate报头域一起使用**
     ​     1. HTTP 401.2 - 未授权：服务器配置问题导致登录失败
     ​         2. HTTP 401.3 - ACL 禁止访问资源
     ​         3. HTTP 401.4 - 未授权：授权被筛选器拒绝
     ​         4. HTTP 401.5 - 未授权：ISAPI 或 CGI 授权失败
     ​         5. 402——保留有效ChargeTo头响应
     ​         6. **403——禁止访问，服务器收到请求，但是拒绝提供服务**
     ​         7. HTTP 403.1 禁止访问：禁止可执行访问
     ​         8. HTTP 403.2 - 禁止访问：禁止读访问
     ​         9. HTTP 403.3 - 禁止访问：禁止写访问
     ​         10. HTTP 403.4 - 禁止访问：要求 SSL
     ​         11. HTTP 403.5 - 禁止访问：要求 SSL 128
     ​         12. HTTP 403.6 - 禁止访问：IP 地址被拒绝
     ​         13. HTTP 403.7 - 禁止访问：要求客户证书
     ​         14. HTTP 403.8 - 禁止访问：禁止站点访问
     ​         15. HTTP 403.9 - 禁止访问：连接的用户过多
     ​         16. HTTP 403.10 - 禁止访问：配置无效
     ​         17. HTTP 403.11 - 禁止访问：密码更改
     ​         18. HTTP 403.12 - 禁止访问：映射器拒绝访问
     ​         19. HTTP 403.13 - 禁止访问：客户证书已被吊销
     ​         20. HTTP 403.15 - 禁止访问：客户访问许可过多
     ​         21. HTTP 403.16 - 禁止访问：客户证书不可信或者无效
     ​         22. HTTP 403.17 - 禁止访问：客户证书已经到期或者尚未生效
4.   ​    404——一个404错误表明可连接服务器，但服务器无法取得所请求的网页，请求资源不存在。输入了错误的URL
5.   ​    **405——用户在Request-Line字段定义的方法不允许**
6.   ​    **406——根据用户发送的Accept头发现无法响应用户发送的数据，请求资源不可访问、无法接受。**
7.   ​    407——类似401，用户必须首先在代理服务器上得到授权
8.   ​    408——客户端没有在用户指定的时间内完成请求
9.   ​    409——对当前资源状态，请求不能完成
10.   ​    410——服务器上不再有此资源且无进一步的参考地址
11.   ​    411——服务器拒绝用户定义的Content-Length属性请求
12.   ​    412——一个或多个请求头字段在当前请求中错误
13.   ​    413——请求的资源大于服务器允许的大小
14.   ​    414——请求的资源URL长于服务器允许的长度
15.   ​    415——请求资源不支持请求项目格式
16.   ​    416——请求中包含Range请求头字段，在当前请求资源范围内没有range指示值，请求也不包含If-Range请求头字段
17.   417——服务器不满足请求Expect头字段指定的期望值，如果是代理服务器，可能是下一级服务器不能满足请求长。
      2. 5**(服务端错误类)：服务器不能正确执行一个正确的请求
18.   HTTP 500 - 服务器遇到错误，无法完成请求
   19.   HTTP 500.100 - 内部服务器错误 - ASP 错误
   20.   ​    　　HTTP 500-11 服务器关闭
   21.   ​    　　HTTP 500-12 应用程序重新启动
   22.   ​    　　HTTP 500-13 - 服务器太忙
   23.   ​    　　HTTP 500-14 - 应用程序无效
   24.   ​    　　HTTP 500-15 - 不允许请求 global.asa
   25.   ​    　　Error 5 01 - 未实现
26.   **HTTP 502 - 网关错误**
27.   **HTTP 503：由于超载或停机维护，服务器目前无法使用，一段时间后可能恢复正常**

